{
  "workflow_id": "wf-adversarial-math-v3-robust",
  "name": "对抗性数学推理工作流 (V3 - 健壮版)",
  "description": "一个多智能体协同工作流，用于解决复杂的数学问题。采用'接力棒'式数据传递，确保数据流的绝对稳健。",
  "roles": [
    {
      "id": "strategist",
      "name": "策略家",
      "description": "生成高层次的解题策略。",
      "system_prompt": "你是一位顶级的数学解题策略家。你的任务是分析一个复杂的数学问题，并提出多种不同角度、高层次的解题策略。不要深入细节，专注于提供概念性的路径和方法论。你的输出必须是严格的JSON格式：{\"strategies\": [\"策略1\", \"策略2\", \"策略3\"]}。"
    },
    {
      "id": "meta_reviewer",
      "name": "元评审员",
      "description": "对上游产出进行评审。",
      "system_prompt": "你是一位批判性的元评审员。你的任务是审查上游提供的内容，并从一致性、覆盖度、新颖性和可行性等维度进行打分。你的输出必须是严格的JSON格式：{\"critique\": {\"summary\": \"...\", \"issues\": [\"...\"], \"suggestions\": [\"...\"]}, \"scores\": [{\"name\": \"consistency\", \"value\": 0.9}]}"
    },
    {
      "id": "planner",
      "name": "计划修正师",
      "description": "根据评审结果决策下一步行动。",
      "system_prompt": "你是一位果断的计划修正师。你的任务是接收评审结果，然后决定下一步的行动。你的输出必须是严格的JSON格式，例如：{\"decision\": \"CONTINUE\", \"selected_items\": [\"item1\"]} 或 {\"decision\": \"STOP\"}。"
    },
    {
      "id": "tactician",
      "name": "战术家",
      "description": "将策略分解为战术。",
      "system_prompt": "你是一位严谨的数学战术家。你的任务是接收一个高层次的解题策略，并将其分解为一系列具体的、可执行的战术步骤。你的输出必须是严格的JSON格式：{\"sub_strategies\": [\"战术1\", \"战术2\", \"战术3\"]}。"
    },
    {
      "id": "solver",
      "name": "求解者",
      "description": "尝试根据战术解决问题。",
      "system_prompt": "你是一位专注的数学求解者。你的任务是根据给定的战术步骤，尽最大努力解决问题。详细展示你的计算过程和推理逻辑。你的输出必须是严格的JSON格式：{\"solution\": \"你的解题过程和答案\"}。"
    },
    {
      "id": "conjecturer",
      "name": "猜想家",
      "description": "提出关键假设。",
      "system_prompt": "你是一位富有创造力的数学家。你的任务是分析一个数学问题，并提出可能有助于解决它的关键猜想或引理。你的输出必须是严格的JSON格式：{\"hypotheses\": [\"假设1\", \"假设2\"]}。"
    },
    {
      "id": "prover",
      "name": "证明者",
      "description": "尝试证明假设。",
      "system_prompt": "你是一位逻辑严密的数学证明者。你的任务是接收一个数学假设，并严格地尝试证明它。你的输出必须是严格的JSON格式：{\"proof\": \"你的证明过程\"}。"
    },
    {
      "id": "disprover",
      "name": "反驳者",
      "description": "尝试证伪假设。",
      "system_prompt": "你是一位持怀疑态度的数学家。你的任务是接收一个数学假设，并尽力去证伪它。你的输出必须是严格的JSON格式：{\"disproof\": \"你的证伪过程\"}。"
    },
    {
      "id": "improver",
      "name": "改进者",
      "description": "提出改进方案。",
      "system_prompt": "你是一位资深的数学家。你的任务是审查所有工作成果，提炼出一个改进方案。你的输出必须是严格的JSON格式：{\"improvement_plan\": {\"weakness\": \"...\", \"suggestion\": \"...\"}}。"
    },
    {
      "id": "aggregator",
      "name": "聚合者",
      "description": "生成最终报告。",
      "system_prompt": "你是一位资深的数学报告撰写人。你的任务是整合整个工作流中产生的所有信息，并生成一份带有置信度评分的最终报告。你的输出必须是严格的JSON格式：{\"final_report\": {\"summary\": \"...\", \"confidence_score\": 0.85}}。"
    }
  ],
  "stages": [
    {
      "stage_id": "stage-1-gen-strategies",
      "name": "1. 生成初始策略",
      "steps": [{ "step_id": "1.1", "tasks": [{ "task_id": "1.1.1", "role": "strategist", "prompt_template": "为问题 '{{context.initial_request}}' 生成 3 个不同的解题策略。", "output_key": "output" }] }]
    },
    {
      "stage_id": "stage-2-review-strategies",
      "name": "2. 评审策略",
      "steps": [{ "step_id": "2.1", "tasks": [{ "task_id": "2.1.1", "role": "meta_reviewer", "prompt_template": "评审以下策略：{{context.output.strategies}}", "output_key": "output" }] }]
    },
    {
      "stage_id": "stage-3-select-strategy",
      "name": "3. 选择最佳策略",
      "steps": [{ "step_id": "3.1", "tasks": [{ "task_id": "3.1.1", "role": "planner", "prompt_template": "根据评审 {{context.output}}，选择最佳策略。", "output_key": "output" }] }]
    },
    {
      "stage_id": "stage-4-decompose-tactic",
      "name": "4. 分解战术",
      "for_each": "strategy in $.output.selected_items",
      "steps": [{ "step_id": "4.1", "tasks": [{ "task_id": "4.1.1", "role": "tactician", "prompt_template": "将策略 '{{strategy}}' 分解为战术。", "output_key": "output" }] }]
    },
    {
      "stage_id": "stage-5-solve-and-hypothesize",
      "name": "5. 并行求解与假设",
      "for_each": "tactic_iteration in $.output.iterations",
      "steps": [
        {
          "step_id": "5.1",
          "tasks": [
            { "task_id": "5.1.1-solve", "role": "solver", "prompt_template": "根据战术 '{{tactic_iteration.loopVarValue}}' 解决问题。", "output_key": "solve_output" },
            { "task_id": "5.1.2-hypothesize", "role": "conjecturer", "prompt_template": "基于战术 '{{tactic_iteration.loopVarValue}}' 提出假设。", "output_key": "hypothesize_output" }
          ]
        }
      ]
    },
    {
      "stage_id": "stage-6-adversarial-check",
      "name": "6. 对抗性检验",
      "for_each": "hypo_iteration in $.hypothesize_output.iterations",
      "steps": [
        {
          "step_id": "6.1",
          "tasks": [
            { "task_id": "6.1.1-prove", "role": "prover", "prompt_template": "证明假设 '{{hypo_iteration.loopVarValue}}'。", "output_key": "prove_output" },
            { "task_id": "6.1.2-disprove", "role": "disprover", "prompt_template": "证伪假设 '{{hypo_iteration.loopVarValue}}'。", "output_key": "disprove_output" }
          ]
        }
      ]
    },
    {
      "stage_id": "stage-7-decide-next-action",
      "name": "7. 决策",
      "steps": [{ "step_id": "7.1", "tasks": [{ "task_id": "7.1.1", "role": "planner", "prompt_template": "综合求解结果 {{context.solve_output}} 和检验结果 {{context.prove_output}}, {{context.disprove_output}}，决定是继续改进还是停止。", "output_key": "output" }] }]
    },
    {
      "stage_id": "stage-8-improve",
      "name": "8. 改进",
      "condition": "{{context.output.decision}} == 'CONTINUE'",
      "steps": [{ "step_id": "8.1", "tasks": [{ "task_id": "8.1.1", "role": "improver", "prompt_template": "根据现有信息提出改进方案。", "output_key": "output" }] }]
    },
    {
      "stage_id": "stage-9-aggregate",
      "name": "9. 聚合报告",
      "condition": "{{context.output.decision}} == 'STOP'",
      "steps": [{ "step_id": "9.1", "tasks": [{ "task_id": "9.1.1", "role": "aggregator", "prompt_template": "整合所有信息，生成最终报告。", "output_key": "final_report" }] }]
    }
  ]
}